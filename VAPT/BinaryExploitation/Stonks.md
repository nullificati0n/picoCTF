### ![picoctf](https://play.picoctf.org/static/media/picoctf-logo-horizontal-white.17fdf0dcdef08dc3396a195b95e3bc29.svg) 
## picoCTF Binary Exploitation: Stonks
# Vulnerability Assessment and Penetration Testing
**Date:** 05/09/2023

**Author:** [nullificati0n](https://github.com/nullificati0n/)

## Application Details

- **Name:** Trading Application
- **Version:** N/A
- **Description:** A simplified trading application written in C

## Executive Summary

This report identifies and assesses security vulnerabilities in the Trading Application code. The assessment revealed several security issues that need attention and mitigation to enhance the application's security posture.

## Vulnerability Details

### 1. Buffer Overflow in `buy_stonks` Function

- **Description:** The `buy_stonks` function reads user input for the API token using `scanf` without specifying a field width limit, which can lead to a buffer overflow if the user enters more than 300 characters.
- **Severity:** High
- **Recommendation:** Modify the `scanf` statement to limit user input to 300 characters to prevent buffer overflow.

#### Proof of Concept (PoC)

The vulnerable code in the `buy_stonks` function is as follows:

```c
char *user_buf = malloc(300 + 1);
printf("What is your API token?\n");
scanf("%300s", user_buf);  // Vulnerable line
printf("Buying stonks with token:\n");
printf(user_buf);
```

An attacker can exploit this vulnerability by providing an input larger than 300 characters, causing a buffer overflow.

```
What is your API token?
`AAAAAAAA...[more than 300 characters]...AAAAAAAA`
```

This input can overwrite adjacent memory and lead to unexpected behavior or crashes.

### 2. Insecure Token Handling

- **Description:** The API token is read directly from user input and printed to the console, exposing the token to users. This is a security risk as API tokens should remain confidential.
- **Severity:** Medium
- **Recommendation:** Securely store API tokens and avoid displaying them to users.

### 3. Lack of Input Validation

- **Description:** The code doesn't validate user input. For example, in the `resp` variable, there's no check to ensure that the user's choice is either 1 or 2.
- **Severity:** Medium
- **Recommendation:** Implement input validation to ensure that user inputs are within expected ranges.

### 4. File Access Without Checking

- **Description:** The code tries to read an API token from a file named "api" without checking if the file exists or if the file read was successful. If the file doesn't exist, it exits with an error message.
- **Severity:** Medium
- **Recommendation:** Check for the existence of the "api" file and handle the case where it doesn't exist more gracefully.

### 5. Use of Untrusted Data

- **Description:** The code uses data read from the user as an API token without validating or sanitizing it, which could lead to security vulnerabilities.
- **Severity:** Medium
- **Recommendation:** Implement proper input validation and sanitization for user-provided data.

## Conclusion

This report highlights security vulnerabilities in the Trading Application code. It is essential to address these vulnerabilities promptly to improve the application's security posture and protect user data.

## Remediation Plan

- Implement input validation to ensure that user inputs are within expected ranges.
- Modify the `scanf` statement in the `buy_stonks` function to limit user input to 300 characters.
- Securely store API tokens and avoid displaying them to users.
- Check for the existence of the "api" file before attempting to read it and handle missing files gracefully.
- Implement proper input validation and sanitization for user-provided data.

